@page "/"
@using FindTradie.Services.TradieManagement.DTOs
@using FindTradie.Shared.Domain.Enums
@inject FindTradie.Web.Services.ITradieApiService TradieService
@inject NavigationManager Navigation

<PageTitle>FindTradie - Find Trusted Local Tradies</PageTitle>

<div class="emergency-banner">Emergency Services Available</div>

<div class="hero-section">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h1 class="hero-title">Find Trusted Local Tradies</h1>
                <p class="hero-subtitle">Connect with verified, available professionals in your area.</p>
                <div class="search-card mt-4">
                    <h3 class="mb-3">What service do you need?</h3>
                    <div class="search-form">
                        <div class="form-floating mb-3 input-with-icon" data-icon="üìç">
                            <input @bind="SearchLocation" class="form-control" id="location" placeholder="" />
                            <label for="location">Your location</label>
                        </div>
                        <div class="form-floating mb-3 input-with-icon" data-icon="üõ†Ô∏è">
                            <select @bind="SelectedCategory" class="form-select service-select" id="service">
                                <option value="" disabled selected>Select a service</option>
                                @foreach (var category in ServiceCategories)
                                {
                                    <option value="@((int)category.Key)">@category.Value</option>
                                }
                            </select>
                            <label for="service">Service needed</label>
                        </div>
                        <div class="form-floating mb-3 input-with-icon" data-icon="‚è±Ô∏è">
                            <select @bind="SelectedUrgency" class="form-select" id="urgency">
                                <option value="false">Within a week</option>
                                <option value="true">Available now / Emergency</option>
                            </select>
                            <label for="urgency">When do you need this?</label>
                        </div>
                        <button class="btn btn-primary btn-find-tradies btn-lg w-100 @(IsSearching ? "btn-loading" : string.Empty)" @onclick="SearchTradies" disabled="@IsSearching">
                            <span>Find Tradies <i class="fa-solid fa-arrow-right ms-2"></i></span>
                        </button>
                        <button class="btn btn-outline-secondary btn-lg w-100 mt-3" @onclick="NavigateToPostJob">Post a Job</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 mt-5 mt-lg-0 text-center">
                <div class="feature-badges">
                    <div class="badge verified mb-3"><i class="fa-solid fa-circle-check me-2"></i>Verified Tradies</div>
                    <div class="badge insured mb-3"><i class="fa-solid fa-shield-halved me-2"></i>Insured</div>
                    <div class="badge quotes"><i class="fa-solid fa-comments-dollar me-2"></i>Free Quotes</div>
                </div>
                <div class="hero-image mt-4">
                    <img src="images/happy-tradies.svg" alt="Happy customers" class="img-fluid" />
                </div>
            </div>
        </div>
    </div>
</div>

<div class="trust-badges">
    <div class="container">
        <div class="row text-center g-3">
            <div class="col-6 col-md-3"><div class="badge-item"><i class="fa-solid fa-lock me-2"></i>SSL Secure</div></div>
            <div class="col-6 col-md-3"><div class="badge-item"><i class="fa-solid fa-rotate-left me-2"></i>Money-back guarantee</div></div>
            <div class="col-6 col-md-3"><div class="badge-item"><i class="fa-solid fa-id-card me-2"></i>Licensed & Insured</div></div>
            <div class="col-6 col-md-3"><div class="badge-item"><i class="fa-solid fa-user-check me-2"></i>Background checked</div></div>
        </div>
    </div>
</div>

<div class="services bg-white">
    <div class="container">
        <h2 class="text-center mb-4">Popular Services</h2>
        <div class="row g-4 mb-4">
            @foreach (var cat in ServiceCategories)
            {
                <div class="col-6 col-md-3">
                    <div class="service-card">
                        <div class="service-icon">@GetIcon(cat.Key)</div>
                        <h6>@cat.Value</h6>
                    </div>
                </div>
            }
        </div>
        <div class="text-center">
            <a href="services" class="view-all-services">View All Services <i class="fa-solid fa-arrow-right ms-1"></i></a>
        </div>
    </div>
</div>

<div class="stats-section">
    <div class="container">
        <div class="row g-4">
            <div class="col-6 col-md-3 stat-item">
                <span class="stat-number" data-count="500">0+</span>
                <span class="stat-label">Verified Tradies</span>
            </div>
            <div class="col-6 col-md-3 stat-item">
                <span class="stat-number">4.8</span>
                <span class="stat-label">Avg Rating</span>
            </div>
            <div class="col-6 col-md-3 stat-item">
                <span class="stat-number" data-count="10000">0+</span>
                <span class="stat-label">Jobs Completed</span>
            </div>
            <div class="col-6 col-md-3 stat-item">
                <span class="stat-number">24/7</span>
                <span class="stat-label">Support</span>
            </div>
        </div>
    </div>
</div>

<div class="how-it-works bg-white">
    <div class="container">
        <h2 class="text-center mb-5">How FindTradie Works</h2>
        <div class="row justify-content-between">
            <div class="col-md-4 text-center mb-4">
                <div class="step-card">
                    <div class="step-number">1</div>
                    <div class="step-icon mb-3"><i class="fa-solid fa-clipboard-list fa-2x"></i></div>
                    <h4>Post Your Job</h4>
                    <p>Describe what you need done, add photos, and set your budget.</p>
                </div>
            </div>
            <div class="col-md-4 text-center mb-4">
                <div class="step-card">
                    <div class="step-number">2</div>
                    <div class="step-icon mb-3"><i class="fa-solid fa-user-group fa-2x"></i></div>
                    <h4>Get Quotes</h4>
                    <p>Receive quotes from verified tradies in your area.</p>
                </div>
            </div>
            <div class="col-md-4 text-center mb-4">
                <div class="step-card">
                    <div class="step-number">3</div>
                    <div class="step-icon mb-3"><i class="fa-solid fa-star fa-2x"></i></div>
                    <h4>Hire & Review</h4>
                    <p>Choose your tradie, track progress, and leave a review.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="testimonials">
    <div class="container">
        <h2 class="text-center mb-4">What Customers Say</h2>
        <div class="row g-4">
            <div class="col-md-4">
                <div class="testimonial-card">
                    <div class="testimonial-stars">
                        <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i>
                    </div>
                    <p class="testimonial-text">Great platform to find reliable tradies. Highly recommended!</p>
                    <div class="testimonial-author">
                        <div class="author-avatar">SM</div>
                        <div><strong>Sarah M.</strong></div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="testimonial-card">
                    <div class="testimonial-stars">
                        <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i>
                    </div>
                    <p class="testimonial-text">Found an electrician within minutes and the job was perfect.</p>
                    <div class="testimonial-author">
                        <div class="author-avatar">JR</div>
                        <div><strong>James R.</strong></div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="testimonial-card">
                    <div class="testimonial-stars">
                        <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i>
                    </div>
                    <p class="testimonial-text">Easy to use and the tradies are top quality.</p>
                    <div class="testimonial-author">
                        <div class="author-avatar">PK</div>
                        <div><strong>Priya K.</strong></div>
                    </div>
                </div>
            </div>
</div>
</div>
</div>

<div class="featured-tradies">
    <div class="container">
        <h2 class="text-center mb-4">Featured Tradies This Week</h2>
        <div class="row g-4">
            <div class="col-md-4">
                <div class="tradie-card">
                    <div class="tradie-header">
                        <div class="tradie-avatar"><span class="avatar-icon">üë©‚Äçüîß</span></div>
                        <div class="tradie-info">
                            <h5>Susan's Plumbing</h5>
                            <div class="rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="tradie-card">
                    <div class="tradie-header">
                        <div class="tradie-avatar"><span class="avatar-icon">‚ö°</span></div>
                        <div class="tradie-info">
                            <h5>Bright Sparks</h5>
                            <div class="rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="tradie-card">
                    <div class="tradie-header">
                        <div class="tradie-avatar"><span class="avatar-icon">üõ†Ô∏è</span></div>
                        <div class="tradie-info">
                            <h5>Handy Andy</h5>
                            <div class="rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="recent-jobs bg-white">
    <div class="container">
        <h2 class="text-center mb-4">Recent Jobs in Your Area</h2>
        <ul class="list-group">
            <li class="list-group-item d-flex justify-content-between">Fix leaky tap <span>$80 - $120</span></li>
            <li class="list-group-item d-flex justify-content-between">Install power point <span>$150 - $200</span></li>
            <li class="list-group-item d-flex justify-content-between">Mow front lawn <span>$40 - $60</span></li>
        </ul>
    </div>
</div>

<div class="trust-security">
    <div class="container">
        <div class="row text-center g-4">
            <div class="col-md-4">
                <div class="trust-badge">
                    <div class="icon">üõ°Ô∏è</div>
                    <h3>Verified & Insured</h3>
                    <p>All tradies are verified and carry insurance</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="trust-badge">
                    <div class="icon">üïí</div>
                    <h3>On-Time Service</h3>
                    <p>We guarantee punctual arrivals</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="trust-badge">
                    <div class="icon">üí¨</div>
                    <h3>Support</h3>
                    <p>24/7 customer support</p>
                </div>
            </div>
        </div>
    </div>
</div>

@if (SearchResults?.Any() == true)
{
    <div class="search-results">
        <div class="container">
            <h3>Available Tradies Near You</h3>
            <div class="row">
                @foreach (var tradie in SearchResults)
                {
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="tradie-card">
                            <div class="tradie-header">
                                <div class="tradie-avatar">
                                    <span class="avatar-icon">üë∑</span>
                                </div>
                                <div class="tradie-info">
                                    <h5>@tradie.BusinessName</h5>
                                    <div class="rating">
                                        @for (int i = 1; i <= 5; i++)
                                        {
                                            <span class="star @(i <= tradie.Rating ? "filled" : "")">‚òÖ</span>
                                        }
                                        <span class="rating-text">@tradie.Rating.ToString("0.0") (@tradie.ReviewCount reviews)</span>
                                    </div>
                                </div>
                            </div>
                            <p class="tradie-description">@tradie.Description</p>
                            <div class="tradie-services mb-3">
                                @foreach (var category in tradie.ServiceCategories.Take(3))
                                {
                                    <span class="service-badge">@GetCategoryName(category)</span>
                                }
                            </div>
                            <div class="tradie-footer d-flex justify-content-between">
                                <div class="distance">üìç @tradie.DistanceKm.ToString("0.0")km away</div>
                                <div class="availability">
                                    @if (tradie.IsAvailable)
                                    {
                                        <span class="status available">Available Now</span>
                                    }
                                    else
                                    {
                                        <span class="status busy">Busy</span>
                                    }
                                </div>
                            </div>
                            <div class="card-actions mt-3">
                                <button class="btn btn-outline-primary" @onclick="() => ViewProfile(tradie.Id)">View Profile</button>
                                <button class="btn btn-primary" @onclick="() => RequestQuote(tradie.Id)">Get Quote</button>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
}

<footer class="site-footer mt-5">
    <div class="container text-center">
        <div class="mb-2">
            <a href="#">About</a> |
            <a href="#">Contact</a> |
            <a href="#">Privacy</a>
        </div>
        <div class="social-links mb-2">
            <a href="#"><i class="fa-brands fa-facebook"></i></a>
            <a href="#"><i class="fa-brands fa-twitter"></i></a>
            <a href="#"><i class="fa-brands fa-instagram"></i></a>
        </div>
        <div class="mb-2">
            <a href="#" class="btn btn-primary btn-sm">Become a Tradie</a>
        </div>
        <div class="payment-icons mb-2">
            <i class="fa-brands fa-cc-visa"></i>
            <i class="fa-brands fa-cc-mastercard"></i>
            <i class="fa-brands fa-cc-paypal"></i>
        </div>
        <div class="app-buttons mb-2">
            <span class="badge bg-secondary">App Store (Coming Soon)</span>
            <span class="badge bg-secondary">Google Play (Coming Soon)</span>
        </div>
        <div>&copy; 2024 FindTradie. All rights reserved.</div>
    </div>
</footer>

@code {
    private string SearchLocation = string.Empty;
    private string SelectedCategory = string.Empty;
    private string SelectedUrgency = "false";
    private bool IsSearching = false;
    private List<TradieProfileSummaryDto>? SearchResults;

    private Dictionary<ServiceCategory, string> ServiceCategories = new()
    {
        { ServiceCategory.Plumbing, "Plumbing" },
        { ServiceCategory.Electrical, "Electrical" },
        { ServiceCategory.Carpentry, "Carpentry" },
        { ServiceCategory.Painting, "Painting" },
        { ServiceCategory.Roofing, "Roofing" },
        { ServiceCategory.HVAC, "Heating & Cooling" },
        { ServiceCategory.Landscaping, "Landscaping" },
        { ServiceCategory.Cleaning, "Cleaning" },
        { ServiceCategory.Handyman, "Handyman" }
    };

    private Dictionary<ServiceCategory, string> ServiceIcons = new()
    {
        { ServiceCategory.Plumbing, "üîß" },
        { ServiceCategory.Electrical, "‚ö°" },
        { ServiceCategory.Carpentry, "üî®" },
        { ServiceCategory.Painting, "üé®" },
        { ServiceCategory.Roofing, "üè†" },
        { ServiceCategory.HVAC, "‚ùÑÔ∏è" },
        { ServiceCategory.Landscaping, "üå≥" },
        { ServiceCategory.Cleaning, "üßπ" },
        { ServiceCategory.Handyman, "üõ†Ô∏è" }
    };

    private async Task SearchTradies()
    {
        if (string.IsNullOrWhiteSpace(SearchLocation))
        {
            return;
        }

        IsSearching = true;
        StateHasChanged();

        try
        {
            var searchRequest = new SearchTradiesRequest(
                Latitude: -37.8136,
                Longitude: 144.9631,
                RadiusKm: 25,
                Categories: !string.IsNullOrEmpty(SelectedCategory) ?
                    new List<ServiceCategory> { (ServiceCategory)int.Parse(SelectedCategory) } : null,
                AvailableNow: bool.Parse(SelectedUrgency)
            );

            var response = await TradieService.SearchTradiesAsync(searchRequest);

            if (response.Success && response.Data != null)
            {
                SearchResults = response.Data;
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Search error: {ex.Message}");
        }
        finally
        {
            IsSearching = false;
            StateHasChanged();
        }
    }

    private string GetCategoryName(ServiceCategory category)
    {
        return ServiceCategories.TryGetValue(category, out var name) ? name : category.ToString();
    }

    private string GetIcon(ServiceCategory category)
    {
        return ServiceIcons.TryGetValue(category, out var icon) ? icon : "üß∞";
    }

    private void ViewProfile(Guid tradieId)
    {
        Navigation.NavigateTo($"/tradie/{tradieId}");
    }

    private void RequestQuote(Guid tradieId)
    {
        Navigation.NavigateTo($"/post-job?tradieId={tradieId}");
    }

    private void NavigateToPostJob()
    {
        Navigation.NavigateTo("post-job");
    }
}
